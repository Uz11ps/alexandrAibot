# Пошаговая инструкция: Получение токена Google Drive

## Шаг 1: Создание проекта в Google Cloud Console

1. Откройте браузер и перейдите на сайт: **https://console.cloud.google.com/**
2. Войдите в свой Google аккаунт (тот же, где создана папка в Drive)
3. Если у вас нет проекта, нажмите на выпадающий список проектов вверху страницы
4. Нажмите **"NEW PROJECT"** (Новый проект)
5. Введите название проекта, например: **"Arheon Bot"**
6. Нажмите **"CREATE"** (Создать)
7. Дождитесь создания проекта (обычно несколько секунд)

## Шаг 2: Включение Google Drive API

1. В левом меню найдите раздел **"APIs & Services"** (API и сервисы)
2. Нажмите на **"Library"** (Библиотека)
3. В поисковой строке введите: **"Google Drive API"**
4. Нажмите на результат **"Google Drive API"**
5. Нажмите кнопку **"ENABLE"** (Включить)
6. Дождитесь активации API (обычно несколько секунд)

## Шаг 3: Настройка экрана согласия OAuth (если требуется)

Если при создании credentials появится запрос на настройку экрана согласия:

1. Выберите **"External"** (Внешний) и нажмите **"CREATE"**
2. Заполните обязательные поля:
   - **App name** (Название приложения): `Arheon Bot`
   - **User support email** (Email поддержки): ваш email
   - **Developer contact information** (Контакт разработчика): ваш email
3. Прокрутите вниз и нажмите **"SAVE AND CONTINUE"** (Сохранить и продолжить)
4. На следующем экране нажмите **"SAVE AND CONTINUE"** еще раз
5. На экране "Scopes" нажмите **"SAVE AND CONTINUE"**
6. На экране "Test users" нажмите **"SAVE AND CONTINUE"**
7. На финальном экране нажмите **"BACK TO DASHBOARD"** (Вернуться на панель)

## Шаг 4: Создание OAuth credentials

1. В левом меню выберите **"APIs & Services"** → **"Credentials"** (Учетные данные)
2. Вверху страницы нажмите **"+ CREATE CREDENTIALS"** (Создать учетные данные)
3. Выберите **"OAuth client ID"** (ID клиента OAuth)
4. Если появится запрос на настройку экрана согласия - выполните Шаг 3 выше
5. В поле **"Application type"** (Тип приложения) выберите **"Desktop app"** (Десктопное приложение)
6. В поле **"Name"** (Название) введите: `Arheon Bot Client`
7. Нажмите **"CREATE"** (Создать)
8. Появится окно с информацией о клиенте - нажмите **"OK"**

## Шаг 5: Скачивание credentials файла

1. В списке "OAuth 2.0 Client IDs" найдите созданный клиент
2. Нажмите на иконку **скачивания** (стрелка вниз) справа от названия клиента
3. Или нажмите на название клиента, затем нажмите **"DOWNLOAD JSON"** (Скачать JSON)
4. Файл будет скачан с названием типа: `client_secret_xxxxx.json`

## Шаг 6: Сохранение credentials файла в проект

1. Переименуйте скачанный файл в: **`google-credentials.json`**
2. Создайте папку **`credentials`** в корне проекта (если её еще нет)
3. Переместите файл **`google-credentials.json`** в папку **`credentials/`**

Структура должна быть такой:
```
AlexandrProfiStroi/
├── credentials/
│   └── google-credentials.json  ← ваш файл здесь
├── main.py
└── ...
```

## Шаг 7: Первый запуск и получение токена

1. Убедитесь, что в файле `.env` установлено:
   ```env
   GOOGLE_DRIVE_ENABLED=true
   GOOGLE_DRIVE_CREDENTIALS_FILE=credentials/google-credentials.json
   GOOGLE_DRIVE_TOKEN_FILE=credentials/google-token.json
   ```

2. Запустите бота:
   ```bash
   python main.py
   ```

3. При первом запуске:
   - Автоматически откроется браузер
   - Войдите в Google аккаунт (тот же, где создана папка в Drive)
   - Нажмите **"Разрешить"** (Allow) для доступа к Google Drive
   - После успешной авторизации браузер закроется

4. В папке `credentials/` автоматически создастся файл **`google-token.json`**
   - Этот файл содержит токены доступа
   - Он будет автоматически обновляться при необходимости

## Готово! ✅

Теперь бот имеет доступ к Google Drive и может:
- Загружать файлы в вашу папку
- Скачивать файлы из папки
- Использовать файлы при генерации постов

## Проверка работы

1. Отправьте команду `/status` боту в Telegram
2. Должно показать: **Google Drive: ✅ Включен**

## Использование

Теперь вы можете загружать файлы через команду `/upload`:
1. Отправьте `/upload` боту
2. Выберите тип папки (например: `photos` или `1`)
3. Отправьте фото или документ
4. Файл автоматически загрузится в Google Drive

## Важные замечания

⚠️ **Безопасность:**
- Файл `google-credentials.json` содержит секретные данные
- НЕ публикуйте его в открытых репозиториях
- Файл уже добавлен в `.gitignore` для безопасности

⚠️ **Токены:**
- Файл `google-token.json` создается автоматически при первом запуске
- Он содержит токены доступа и автоматически обновляется
- Если токены истекли, бот автоматически запросит новые

⚠️ **Права доступа:**
- Убедитесь, что Google аккаунт имеет доступ к папке в Drive
- Папка должна быть доступна для записи

## Устранение проблем

**Ошибка "Файл credentials не найден":**
- Проверьте, что файл `google-credentials.json` находится в папке `credentials/`
- Проверьте путь в `.env`: `GOOGLE_DRIVE_CREDENTIALS_FILE`

**Ошибка авторизации:**
- Удалите файл `google-token.json` и запустите бота заново
- Убедитесь, что Google Drive API включен в проекте

**Браузер не открывается:**
- Скопируйте URL из консоли и откройте вручную в браузере
- После авторизации скопируйте код из браузера обратно в консоль

**Ошибка доступа к папке:**
- Убедитесь, что ID папки указан правильно в `.env`
- Проверьте, что у Google аккаунта есть права на запись в папку

## Дополнительная помощь

Если возникли проблемы:
1. Проверьте логи бота в консоли
2. Убедитесь, что все шаги выполнены правильно
3. Проверьте, что ID папки указан верно в `.env`

